<html>
<head>
    <title>Multiplication trainer</title>
</head>
<style>
#mult_trainer div span {
    display: inline-block;
    width: 100px;
    margin-left: 10px;
    margin-right: 10px;
}
</style>
<body>
<h1>Multiplication trainer</h1>

<div>
Hvad er <span id="input1">3</span> gange <span id="input2">2</span>?
<br>
<input id="answer"></input>
</div>

<div id="timer">
<span id="timer_value">0 </span> sekunder
</div>

<div style="height: 50px;">
</div>

<div id="mult_trainer"></div>
<script>
let trainer = document.getElementById("mult_trainer");
let numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9];
let timer = NaN;

function addNumberToRowInMultipliactionTrainer(outerNumber, innerNumber, rowElement) 
{
    let elem = document.createElement("span");
    elem.innerHTML = outerNumber + " x " + innerNumber;
    rowElement.appendChild(elem);
}

function addNumberToMultiplicationTrainer(number) {
    let elem = document.createElement("div");
    trainer.appendChild(elem);
    let row_name = document.createElement("span");
    row_name.innerHTML = number
    elem.appendChild(row_name);

    numbers.forEach((n) => addNumberToRowInMultipliactionTrainer(number, n, elem));
}

function addColumnNumber(number) {
    let elem = document.createElement("span");
    elem.innerHTML = number;
    trainer.firstChild.appendChild(elem);
}

trainer.appendChild(document.createElement("div"));
trainer.firstChild.appendChild(document.createElement("span"));
numbers.forEach(addColumnNumber)
numbers.forEach(addNumberToMultiplicationTrainer);

let current_problem = NaN;

function show_next_problem() {
    let all_spans = document.getElementById("mult_trainer").querySelectorAll("span");
    let remaining_problems = Array.from(all_spans).filter((e) => e.innerText.includes("x") );
    if(remaining_problems.length > 0)
    {
        let random_problem = remaining_problems[Math.floor(Math.random() * remaining_problems.length)];
        current_problem = random_problem;
        let problem_components = random_problem.innerText.split(" ");
        document.getElementById("input1").innerText = problem_components[0];
        document.getElementById("input2").innerText = problem_components[2];
    }
    else 
    {
        // Stop timer
        alert("Færdig, godt gået!");
        document.getElementById("answer").removeEventListener("keyup", check_answer);
        let message = "Du løste " + numbers.length**2 + " gangestykker på " + (Date.now() - timer) / 1000 + " sekunder.";
        document.getElementById("timer").innerText = message;
    }
}

show_next_problem();

function check_answer() {
    if(isNaN(timer))
    {
        timer = Date.now(); 
    }
    document.getElementById("timer_value").innerText = (Date.now() - timer) / 1000;
    let input1 = document.getElementById("input1").innerText;
    let input2 = document.getElementById("input2").innerText;
    let answer = document.getElementById("answer").value;
    if(input1 * input2 == answer)
    {
        current_problem.innerText = answer;
        document.getElementById("answer").value = "";
        show_next_problem();
    }
}

document.getElementById("answer").addEventListener("keyup", check_answer);
</script>
</body>
</html>